#+TITLE: uProg - Svarte Jakob
#+AUTHOR: Alfred Sjöqvist, Sebastian Karlsson, Oliver Brenner, Isak Bong Olsson

* Lathund:
** 1-bit
| NUM | GrS                         | PCS  | noFlag                      |
|-----+-----------------------------+------|-----------------------------|
|   0 | GRx-mux styrs av GRx-fältet | NOP  | ALU uppdaterar flaggor      |
|   1 | GRx-mux styrs av M-fältet   | PC++ | ALU uppdaterar inte flaggor |

** 2-bit
| NUM | LCs     |
|-----+---------|
|  00 | NOP     |
|  01 | LC--    |
|  10 | LC=Buss |
|  11 | LC=uADR |

** 4-bit
|  NUM | ALU                     | SEQ         |
|------+-------------------------+-------------|
| 0000 | NOP                     | uPC++       |
| 0001 | Bus                     | uPC=K1      |
| 0010 | Bus'                    | uPC=K2      |
| 0011 | 0                       | uPC=0       |
| 0100 | AR + Bus                | uPC=uADR    |
| 0101 | AR - Bus                | Hopp om Z=0 |
| 0110 | AR AND Bus              | Hopp om N=0 |
| 0111 | AR OR Bus               | Hopp om C=0 |
| 1000 | AR * Bus                | Hopp om O=0 |
| 1001 | AR sign* Bus            | Hopp om L=0 |
| 1010 | LSR AR                  | Hopp om Z=1 |
| 1011 | LSL AR                  | Hopp om N=1 |
| 1100 | -                       | Hopp om C=1 |
| 1101 | -                       | Hopp om O=1 |
| 1110 | -                       | Hopp om L=1 |
| 1111 | -                       | HALT        |

** 4-bit (bus)
|  NUM | TB    | FB    |
|------+-------+-------|
| 0000 | NOP   | NOP   |
| 0001 | IR    | IR    |
| 0010 | PM    | PM    |
| 0011 | ASR   | ASR   |
| 0100 | AR    | -     |
| 0101 | HR    | HR    |
| 0110 | GrX   | GrX   |
| 0111 | PC    | PC    |
| 1000 | KeyBd | -     |
| 1001 | VGA   | VGA   |
| 1010 | -     | Sound |
| 1011 | SP    | SP    |
| 1100 | uMem  |       |
| 1101 | -     | -     |
| 1110 | -     | -     |
| 1111 | -     | -     |

* EXEMPEL:
** uPROG
| ADR |  ALU |  TB |  FB | S | P | LC |  SEQ |    uADR | HEX | Kommentar                                                   |
|-----+------+-----+-----+---+---+----+------+---------+-----+-------------------------------------------------------------|
|  00 | 0000 | 011 | 111 | 0 | 0 | 00 | 0000 | 0000000 |     | ASR := PC                                                   |
|  01 | 0000 | 010 | 001 | 0 | 1 | 00 | 0000 | 0000000 |     | IR := PM, PC++                                              |
|  02 | 0000 | 000 | 000 | 0 | 0 | 00 | 0010 | 0000000 |     | uPC := K2(M-fältet)                                         |
|  03 | 0000 | 001 | 111 | 0 | 0 | 00 | 0001 | 0000000 |     | ASR := IR, uPC := K1(OP-fältet)       ; Direktaddressering  |
|  04 | 0000 | 011 | 111 | 0 | 1 | 00 | 0001 | 0000000 |     | ASR := PC, PC++, uPC := K1(OP-fältet) ; Immediate           |
|  05 | 0000 | 001 | 111 | 0 | 0 | 00 | 0000 | 0000000 |     | ASR := IR ; Indirekt                                        |
|  06 | 0000 | 010 | 111 | 0 | 0 | 00 | 0001 | 0000000 |     | ASR := PM, uPC := K1(OP-fältet) ; Se kommentar i Uppgift 3  |
|  07 | 0001 | 001 | 000 | 0 | 0 | 00 | 0000 | 0000000 |     | AR := IR ; Indexerad adressering                            |
|  08 | 1000 | 110 | 000 | 1 | 0 | 00 | 0000 | 0000000 |     | AR := GR3+AR                                                |
|  09 | 0000 | 100 | 111 | 0 | 0 | 00 | 0001 | 0000000 |     | ASR := AR, uPC := K1(OP-fältet)                             |
|  0A | 0000 | 000 | 000 | 0 | 0 | 00 | 1111 | 0000000 |     | --HALT                                                      |
|  0B | 0000 | 010 | 110 | 0 | 0 | 00 | 0011 | 0000000 |     | --LOAD GRx,M,ADR: GRx := PM(A), uPC := 0                    |
|  0C | 0000 | 110 | 010 | 0 | 0 | 00 | 0011 | 0000000 |     | --STORE GRx,M,ADR: PM(A) := GRx, uPC := 0                   |
|  0D | 0001 | 110 | 000 | 0 | 0 | 00 | 0000 | 0000000 |     | --ADD GRx,M,ADR: GRx := GRx+PM(A) ; AR := GRx, uPC := 0     |
|  0E | 0100 | 010 | 000 | 0 | 0 | 00 | 0000 | 0000000 |     | AR := AR + PM(A)                                            |
|  0F | 0000 | 100 | 110 | 0 | 0 | 00 | 0011 | 0000000 |     | GRx := AR, uPC := 0                                         |
|  10 | 0001 | 110 | 000 | 0 | 0 | 00 | 0000 | 0000000 |     | --SUB GRx,M,ADR: GRx := GRx-PM(A) ; AR := GRx               |
|  11 | 0101 | 010 | 000 | 0 | 0 | 00 | 0000 | 0000000 |     | AR := AR - PM(A)                                            |
|  12 | 0000 | 100 | 110 | 0 | 0 | 00 | 0011 | 0000000 |     | GRx := AR, uPC := 0                                         |
|  13 | 0001 | 110 | 000 | 0 | 0 | 00 | 0000 | 0000000 |     | --AND GRx,M,ADR: GRx := GRx&PM(A) ; AR := GRx               |
|  14 | 0110 | 010 | 000 | 0 | 0 | 00 | 0000 | 0000000 |     | AR := AR & PM(A)                                            |
|  15 | 0000 | 100 | 110 | 0 | 0 | 00 | 0011 | 0000000 |     | GRx := AR, uPC := 0                                         |
|  16 | 0000 | 001 | 000 | 0 | 0 | 10 | 0000 | 0000000 |     | --LSR GRx,M,Y: GRx >> Y ; LC := ADR                         |
|  17 | 0001 | 110 | 000 | 0 | 0 | 01 | 0000 | 0000000 |     | AR := GRx, LC-- to move correct amount                      |
|  18 | 1101 | 000 | 000 | 0 | 0 | 01 | 1100 | 0011010 |     | AR >> 1, LC--, Jump forward to 1A if LC=0                   |
|  19 | 0000 | 000 | 000 | 0 | 0 | 00 | 0101 | 0011000 |     | Jump back to 18                                             |
|  1A | 0000 | 100 | 110 | 0 | 0 | 00 | 0011 | 0000000 |     | GRx := AR, uPC := 0                                         |
|  1B | 0000 | 000 | 000 | 0 | 0 | 00 | 1000 | 0011111 |     | --BNE ADR: PC := Z==0 ? PC+1+ADR : PC+1 ; Jump to 1F if Z=1 |
|  1C | 0001 | 001 | 000 | 0 | 0 | 00 | 0000 | 0000000 |     | --BRA ADR: PC := PC+1+ADR ; AR := IR                        |
|  1D | 1000 | 011 | 000 | 0 | 0 | 00 | 0000 | 0000000 |     | AR := AR+PC                                                 |
|  1E | 0000 | 100 | 011 | 0 | 0 | 00 | 0000 | 0000000 |     | PC := AR                                                    |
|  1F | 0000 | 000 | 000 | 0 | 0 | 00 | 0011 | 0000000 |     | uPC := 0                                                    |
|  20 | 0001 | 110 | 000 | 0 | 0 | 00 | 0000 | 0000000 |     | --CMP GRx,M,ADR: AR := GRx-PM(A) ; AR := GRx                |
|  21 | 0101 | 010 | 000 | 0 | 0 | 00 | 0011 | 0000000 |     | AR := AR - PM(A), uPC := 0                                  |
|  22 | 0000 | 000 | 000 | 0 | 0 | 00 | 1001 | 0100101 |     | --BGE ADR: Jump if >= ; N==1 ? uPC := 25                    |
|  23 | 0000 | 000 | 000 | 0 | 0 | 00 | 1011 | 0011111 |     | O==1 ? uPC := 1F                                            |
|  24 | 0000 | 000 | 000 | 0 | 0 | 00 | 1110 | 0011100 |     | O==0 uPC := 1C                                              |
|  25 | 0000 | 000 | 000 | 0 | 0 | 00 | 1110 | 0011111 |     | O==0 ? uPC := 1F                                            |
|  26 | 0000 | 000 | 000 | 0 | 0 | 00 | 1011 | 0011100 |     | O==1 uPC := 1C                                              |
|  27 | 0000 | 000 | 000 | 0 | 0 | 00 | 1000 | 0011100 |     | --BEQ ADR: Jump if== ; Z==0 ? uPC := 1C                     |
|  28 | 0000 | 000 | 000 | 0 | 0 | 00 | 0011 | 0000000 |     | uPC := 0                                                    |


** K1
| ADR | INS   | JMP |
|-----+-------+-----|
|  01 | LD    |  20 |
|  02 | ST    |  21 |
|  03 | CMP   |  22 |
|  04 | ADD   |  24 |
|  05 | SUB   |  27 |
|  06 | AND   |  2A |
|  07 | OR    |  2D |
|  08 | MUL   |  30 |
|  09 | MULS  |  33 |
|  0A | LSR   |  36 |
|  0B | LSL   |  39 |
|  0C | INV   |  3C |
|  0D | ---   |  -- |
|  0E | ---   |  -- |
|  0F | HALT  |  4F |
|  10 | JMP   |  50 |
|  11 | RJMP  |  51 |
|  12 | BEQ   |  54 |
|  13 | BNE   |  56 |
...
|  20 | RIV   |  80 |


** K2
| ADR  | JMP |
|------+-----|
| 0000 |  03 |
| 0001 |  04 |
| 0010 |  05 |
| 0011 |  07 |
| 0100 |  0A |